{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/blog/1/","result":{"data":{"site":{"siteMetadata":{"title":"Mehran Mirkhan"}},"markdownRemark":{"id":"c8750bc0-d184-56a3-8e18-5d568efaad0e","excerpt":"Intro This article is also published on Medium Introduction I’ve always struggled with writing integration tests. Why? Because in writing integration tests, I try to mimic the environment in which my application is going to be deployed. This includes simulating databases, message brokers, and also other APIs. Simulating infrastructures (DBs and message brokers) is easy. You would just run a docker container. But what can be done about external business APIs?","html":"<p><img src=\"https://miro.medium.com/v2/resize:fit:1400/0*64M0QsnGxrldsqvE\" alt=\"Intro\"></p>\n<figcaption>Photo by <a href=\"https://unsplash.com/@mbaumi?utm_source=medium&utm_medium=referral\">Mika Baumeister</a> on <a href=\"https://unsplash.com/?utm_source=medium&utm_medium=referral\">Unsplash</a></figcaption>\n<blockquote>\n<p>This article is also published on <a href=\"https://medium.com/@mehranmirkhan/a-trick-to-mock-apis-for-testing-f7154ca64c07\">Medium</a></p>\n</blockquote>\n<h1>Introduction</h1>\n<p>I’ve always struggled with writing integration tests. Why? Because in writing integration tests, I try to mimic the environment in which my application is going to be deployed. This includes simulating databases, message brokers, and also other APIs. Simulating infrastructures (DBs and message brokers) is easy. You would just run a docker container. But what can be done about external business APIs?</p>\n<!-- end -->\n<h1>An Example API</h1>\n<p>Imagine we are writing multiple microservices and they depend on an API that provides information about orders. Every order has a structure like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-json line-numbers\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"orderNumber\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"5743982793\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"orderDate\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2021-09-01\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"orderStatus\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"DELIVERED\"</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>These microservices perform different actions based on different order details — For example, if the order status is “<strong>DELIVERED</strong>” we should write it to a database. If the status is something else, then we should check the orderDate and if it is ordered more than 5 days ago we should send this info to a message broker. You can imagine any other business requirements as you like.</p>\n<p>Now the question is that how would you mock this API if you need it in your integration tests? The approach that comes to mind is to create a lot of sample orders in a database each with different details and then use each one in a test scenario — However, the problem with this approach is that it becomes exponentially harder to cover all the possibilities of the order details. What if the order has multiple status fields for example (like shipping status)?</p>\n<h1>A Nice Idea</h1>\n<p>The idea that I want to propose is to encode the details into the identifier! In our example, the mocked order API would create a fake order on the fly with details that are based on the given order number:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.316455696202528%; position: relative; bottom: 0; left: 0; background-image: url('data:image/webp;base64,UklGRkwAAABXRUJQVlA4IEAAAABwAwCdASoUAAUAPtFYpEwoJSOiMAgBABoJaQAAXiHQNwIHdvAA/vYSd77MTwjlcpUDipR8VFhS3Z/HhJSfAAAA'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Example Order\"\n        title=\"\"\n        src=\"/static/ed6dfef4a7e55205a6afcb6f75561c41/8aab1/example-order.webp\"\n        srcset=\"/static/ed6dfef4a7e55205a6afcb6f75561c41/81b7c/example-order.webp 158w,\n/static/ed6dfef4a7e55205a6afcb6f75561c41/6ea66/example-order.webp 315w,\n/static/ed6dfef4a7e55205a6afcb6f75561c41/8aab1/example-order.webp 630w,\n/static/ed6dfef4a7e55205a6afcb6f75561c41/a70f5/example-order.webp 945w,\n/static/ed6dfef4a7e55205a6afcb6f75561c41/4ef06/example-order.webp 1260w,\n/static/ed6dfef4a7e55205a6afcb6f75561c41/7f403/example-order.webp 1400w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>In the above image, we are interpreting the first 3 digits to represent how many days ago the order was created; and we interpret the next 2 digits to represent the status of the order. Now when you write your test scenarios, you can test different possibilities of the orders by just providing specific order numbers. In this very simple example, you can produce 1000*100 different order possibilities which would have been impossible if you wanted to create actual example orders to serve them in your mock service.</p>","frontmatter":{"title":"A Trick to Mock APIs for Testing","date":"September 05, 2021","description":"A nice idea to make writing integration tests easier"}},"previous":{"fields":{"slug":"/demo/"},"frontmatter":{"title":"Hello World","hidden":true}},"next":null},"pageContext":{"id":"c8750bc0-d184-56a3-8e18-5d568efaad0e","previousPostId":"db0b0c73-1659-5951-b961-902e561be661","nextPostId":null}},"staticQueryHashes":[],"slicesMap":{}}